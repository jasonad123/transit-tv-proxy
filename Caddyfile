:8080 {
    # Logging for Railway monitoring and debugging
    log {
        format json
        output stdout
        level ERROR
    }

    header {
        X-Content-Type-Options nosniff
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "microphone=(), camera=(), payment=()"
        -Server
    }

    handle /health {
        respond "OK" 200
    }

    # Straight reverse proxy to Transit TV with Railway optimizations
    handle {
        reverse_proxy {$TRANSIT_TV_DOMAIN}:{$TRANSIT_TV_PORT} {
            transport http {
                dial_timeout 90s
                response_header_timeout 90s
            }
            lb_try_duration 90s
            header_up X-Real-IP {remote_host}
            header_up Host {host}
            flush_interval -1
        }
    }
}
