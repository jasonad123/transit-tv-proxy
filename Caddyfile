:8080 {
    # Logging for Railway monitoring and debugging
    log {
        format json
        output stdout
    }

    # Compression for API responses and static content
    encode {
        gzip {
            level 5
        }
    }

    # Security headers for production deployment
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=()"
        -Server
    }

    # Health check endpoint for Railway
    handle /health {
        respond "OK" 200
    }

    # Straight reverse proxy to Transit TV with Railway optimizations
    handle {
        reverse_proxy http://transit-tv.railway.internal:8080 {
            transport http {
                dial_timeout 60s
                response_header_timeout 60s
            }
            lb_try_duration 60s
            header_up X-Real-IP {remote_host}
            header_up Host {host}
            flush_interval -1
        }
    }
}
