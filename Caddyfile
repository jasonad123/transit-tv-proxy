:8080 {
    # Logging for Railway monitoring and debugging
    log {
        format json
        output stdout
        level {$LOG_LEVEL}
    }

    # Security headers for production deployment
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "microphone=(), camera=(), payment=()"
        -Server
    }

    # Health check endpoint for Railway
    handle /health {
        respond "OK" 200
    }

    # Straight reverse proxy to Transit TV with Railway optimizations
    handle {
        reverse_proxy {$TRANSIT_TV_DOMAIN} {
            transport http {
                dial_timeout 90s
                response_header_timeout 90s
            }
            lb_try_duration 90s
            header_up X-Real-IP {remote_host}
            header_up Host {host}
            flush_interval -1
        }
    }
}
